{% extends 'quiz/base.html' %}
{% load bootstrap %}
{% load static%}
{% load quiz_filter %}
{% block title %}Quizzes{% endblock %}
{% block content %}
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
		<link rel="stylesheet" href="{% static 'quiz/css/quiz.min.css' %}">
		<link rel="stylesheet" href="{% static 'quiz/css/content.min.css' %}">
  </head>
  <body>
		{% include 'quiz/navbar.html' %}
		<div class="wrapper quizzes_wrapper">

			{% if correct_quizzes %}
				<h1 class="section_head">Quizzes You Got Right</h1>
			{% elif wrong_quizzes %}
				<h1 class="section_head">Quizzes You Got Wrong</h1>
			{% elif login_user %}
				<h1 class="section_head">{{login_user.nickname}}'s Favorite Quizzes</h1>
			{% else %}
  			<h1 class="section_head">問 - Quizzes</h1>
			{% endif %}
			<div class="filtered_section">
				{% if request.GET.q %}
					<h2>Quizzes with <span>"{{request.GET.q}}"</span></h2>
				{% endif %}
			</div>

			<div class="quizzes_container">
	      {% for quiz in quiz_page_obj %}
				<div class="quiz_container">
	        <div class="quiz_question"><!--question-->
	        	{% if user.is_authenticated or quiz.public %}
	          	{% if not quiz.public %} Draft {% endif %}<h2>{{quiz.question | safe}}</h2>
	        </div>
	        <div class="quiz_body_container" name="{{quiz.answer}}">
						<div class="choice_section" id="quiz_{{quiz.pk}}_choice_section" name="{{quiz.pk}}">
		          {% include 'quiz/quizzes/choice_section.html' %}
						</div>
						<div class="quiz_bottom">
	          <div class="quiz_info"><!--quiz_info-->
	            <div class="level_category"><!--level_category-->
	              <a class="level {{quiz.level.slug}}" href="{% url 'quiz:level_post' quiz.level.slug %}">{{quiz.level}}</a>
	              <a class="category {{quiz.category.slug}}" href="{% url 'quiz:category_post' quiz.category.slug %}">{{quiz.category}}</a>
	            </div>
							<div class="answer_button">
								<a class="answer_button_a" id="{{quiz.pk}}">
									Answer
								</a>
								<div class="like_section quiz_like_section" id="quiz_{{quiz.pk}}_like_section">
									{% include 'quiz/quizzes/like.html' %}
								</div>
							</div>
	            <div class="quiz_tags"><!--tags-->
	              {% for tag in quiz.tags.all %}
	                <a class="tag" href="{% url 'quiz:tag_post' tag.slug %}">{{ tag.name }}</a>
	              {% endfor %}
	            </div>

	        	</div>
	          <div class="quiz_collapse" id="collapse-{{quiz.pk}}">
	            <span class="correct_answer">{{quiz.answer}}</span>
							<div class="question_description">
								{% if quiz.question_yomi %}
									<div class="question_yomi">
										{{ quiz.question_yomi |safe }}
									</div>
								{% endif %}
								{% if quiz.question_reading %}
									<div class="question_reading">
										<audio
										 controls
										 src="{{quiz.question_reading}}">
												 Your browser does not support the
												 <code>audio</code> element.
								 		 </audio>
									</div>
								{% endif %}
								{% if quiz.question_en %}
									<div class="question_en">
										{{ quiz.question_en | safe }}
									</div>
								{% endif %}
							</div>
							{% if quiz.explanation %}
								<div class="quiz_explanation content">
									{{quiz.explanation|safe}}
								</div>
							{% endif %}
							{% if quiz.choice1_detail %}
		            <div class="choices_description">
		              {% if quiz.choice1_detail %}
		                <p>Choices</p>
		              {% endif %}
		              {% if quiz.choice1_detail %}
		                <div class="answer answer_choice1">
		                  <span>1. </span>{{ quiz.choice1_detail | safe }}
		                </div>
		              {% endif %}
		              {% if quiz.choice2_detail %}
		                <div class="answer answer_choice2">
		                  <span>2. </span>{{ quiz.choice2_detail | safe }}
		                </div>
		              {% endif %}
		              {% if quiz.choice3_detail %}
		                <div class="answer answer_choice3">
		                  <span>3. </span>{{ quiz.choice3_detail | safe}}
		                </div>
		              {% endif %}
		              {% if quiz.choice4_detail %}
		                <div class="answer answer_choice4">
		                  <span>4. </span>{{ quiz.choice4_detail | safe }}
		                </div>
		              {% endif %}
	            	</div>
							{% endif %}
	            <div class="description"><!--DetailDescription-->
                {% for detail in quiz.descriptiondetail_set.all  %}
									<div class="detail_description">
	                  {% if detail.word %}
	                    <div class="detail_word">
	                      {{ detail.word  |safe }}
	                    </div>
	                  {% endif %}
										{% if detail.word_form %}
											<div class="detail_word_form">
												{{ detail.word_form  |safe }}:
											</div>
										{% endif %}
										{% if detail.word_in_sentence %}
											<div class="detail_word_in_sentence">
												{{ detail.word_in_sentence  |safe }}
											</div>
										{% endif %}
	                  {% if detail.yomi %}
	                    <div class="detail_yomi">
	                      <span>読:</span>{{ detail.yomi  |safe }}
	                    </div>
	                  {% endif %}
	                  {% if detail.definition %}
	                    <div class="detail_definition">
	                      <span>義:</span>{{ detail.markdown_definition  |safe }}
	                    </div>
	                  {% endif %}
	                  {% if detail.usage %}
	                    <div class="detail_usage">
                      	<span>用:</span>{{ detail.markdown_usage | safe}}
	                    </div>
	                  {% endif %}
	                  {% if detail.example_ja %}
	                    <div class="detail_example_ja">
                      	<span>日:</span>{{ detail.example_ja |safe }}
	                    </div>
	                  {% endif %}
	                  {% if detail.example_yomi %}
	                    <div class="detail_example_yomi">
	                      <span>読:</span>{{ detail.example_yomi |safe }}
	                    </div>
	                  {% endif %}
	                  {% if detail.example_en %}
	                    <div class="detail_example_en">
                      	<span>英:</span>{{ detail.example_en | safe}}
	                    </div>
	                  {% endif %}
									</div>
                {% endfor %}

	            </div>
	          </div>
	        </div>
	        {% endif %}
				</div>
				</div>
      	{% endfor %}
			</div>

			{% include "quiz/quizzes/quiz_sidebar.html" %}

			{% include "quiz/quizzes/quiz_pagination.html" %}
		</div>
		<script type="text/javascript">

		$(document).on('click', '.quiz_like_button',function(event){
			event.preventDefault();
			var quiz_id = $(this).attr('id')
			var quiz_id_like_section = '#quiz_' + quiz_id + '_like_section'
		      $.ajax({
		               type: "POST",
		               url: "{% url 'quiz:quiz_like' %}",
		               data: {'pk': quiz_id, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
		               dataType: "json",
		               success: function(response) {
											$(quiz_id_like_section).html(response['form'])
		                },

		          });
		    })

			$(document).on('click', '.quiz_choice_button',function(event){
				event.preventDefault();
				var selected_choice = $(this).attr('name')
				var quiz_id = $(this).parent().parent().parent().attr('name')
				var choice_and_id = $(this).attr('id')
				var quiz_id_choice_section = '#quiz_' + quiz_id + '_choice_section'
				var correct_choice = $(this).parent().parent().parent().parent().attr('name')
						$.ajax({
										 type: "POST",
										 url: "{% url 'quiz:quiz_choice' %}",
										 data: {
											'pk': quiz_id,
											'csrfmiddlewaretoken': '{{ csrf_token }}',
											'selected_choice': selected_choice,
											'correct_choice': correct_choice,
										},
										 dataType: "json",
										 success: function(response) {

												$(quiz_id_choice_section).html(response['form'])
											},

								});
					})
		</script>
	 </body>
	</body>
</html>
{% endblock %}
